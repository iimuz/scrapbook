<!DOCTYPE html>
<html lang='en'><head>
  <title>Python開発環境を dockerで構築します | しさく</title>
  <meta charset='utf-8'>
  <meta name="generator" content="Hugo 0.60.1" />
  <meta name = 'viewport' content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no'>
  <meta http-equiv = 'X-UA-Compatible' content = 'IE=edge'>
<meta property = 'og:locale' content = 'en_US' />
<meta property="og:type" content="article">
<meta property = 'og:title' content = 'Python開発環境をDockerで構築します' />
<meta name="description" content="目標 深層学習の勉強で実際に実行できる環境を整えようと思ったのですが、 以前から入っているpython環境とは別にしたいのでDockerで構築してみました。
pythonにインストールするライブラリは、 O&#39;REILLY ゼロから作るDeep Learningが動作する環境です。 したがって、下記の環境になります。 …">
<meta property = 'og:description' content = '目標 深層学習の勉強で実際に実行できる環境を整えようと思ったのですが、 以前から入っているpython環境とは別にしたいのでDockerで構築してみました。
pythonにインストールするライブラリは、 O&#39;REILLY ゼロから作るDeep Learningが動作する環境です。 したがって、下記の環境になります。 …'>
<meta property = 'og:url' content = 'http://iimuz.github.io/scrapbook/softwaretool/docker/pythonenvwithdocker/' />
<meta property = 'og:image' content = 'images/%!s()'/>
<meta name = 'twitter:card' content = 'summary_large_image' />
<meta name = 'twitter:creator' content = ''>
<meta name = 'twitter:title' content = 'Python開発環境をDockerで構築します' />
<meta property = 'twitter:description'  content = '目標 深層学習の勉強で実際に実行できる環境を整えようと思ったのですが、 以前から入っているpython環境とは別にしたいのでDockerで構築してみました。
pythonにインストールするライブラリは、 O&#39;REILLY ゼロから作るDeep Learningが動作する環境です。 したがって、下記の環境になります。 …'/>
<meta name = 'twitter:image' content = 'images/%!s()' />
<link rel='apple-touch-icon' sizes='180x180' href='http://iimuz.github.io/scrapbook/images/icons/apple-touch-icon.png'>
<link rel='icon' type='image/png' sizes='32x32' href='http://iimuz.github.io/scrapbook/images/icons/favicon-32x32.png'>
<link rel='icon' type='image/png' sizes='16x16' href='http://iimuz.github.io/scrapbook/images/icons/favicon-16x16.png'>
<link rel='manifest' href='http://iimuz.github.io/scrapbook/images/icons/site.webmanifest'>

  <link rel='canonical' href='http://iimuz.github.io/scrapbook/softwaretool/docker/pythonenvwithdocker/'>
  <link rel = 'stylesheet' href = 'http://iimuz.github.io/scrapbook/css/styles.f95ea6b308573243e51a075c5efaf605fe1950268a99f0a2427e5262d11465d0036a6169952dee35760d783dc0ff485221df3ed26a15748d824a97e65b5d7c9e.css' integrity = 'sha512-&#43;V6mswhXMkPlGgdcXvr2Bf4ZUCaKmfCiQn5SYtEUZdADamFplS3uNXYNeD3A/0hSId8&#43;0moVdI2CSpfmW118ng=='>
</head>

  <body><div class = 'nav-drop'>
  <div class = 'nav-body'>
      <a href = 'http://iimuz.github.io/scrapbook/search/' class = 'nav_item'>search</a>
      <a href = 'http://iimuz.github.io/scrapbook/tags/' class = 'nav_item'>tags</a>
      <a href = 'http://iimuz.github.io/scrapbook/categories/' class = 'nav_item'>categories</a>
    <div class = 'nav-close'></div>
  </div>
</div><header class = 'nav' >
  <nav class = 'nav-menu'>
    <a href='http://iimuz.github.io/scrapbook/' class = 'nav-brand nav_item'>しさく</a>
    <div class = 'nav_bar-wrap'>
      <div class = 'nav_bar'></div>
    </div>
  </nav>
</header>



    <main>
  
<section class = 'post_header' style = 'background-image:url(http://iimuz.github.io/scrapbook/images/thumbnail.svg);'>
  <h1 class='post_title'>Python開発環境をDockerで構築します</h1>
</section>
<div class = 'post'>
  <article class='post_content'><h1 id="heading">目標</h1>
<p>深層学習の勉強で実際に実行できる環境を整えようと思ったのですが、
以前から入っているpython環境とは別にしたいのでDockerで構築してみました。</p>
<p>pythonにインストールするライブラリは、
O'REILLY ゼロから作るDeep Learningが動作する環境です。
したがって、下記の環境になります。</p>
<ul>
<li>Python 3.x</li>
<li>NumPy</li>
<li>Matplotlib</li>
</ul>
<h1 id="heading1">結論</h1>
<p>python環境を構築するdockerファイルは下記になりました。
もはやdockerfile必要なのかというレベルで何も書いていないです。(楽すぎます)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> python:3.5.2</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> pip install numpy matplotlib<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><h1 id="heading2">理由</h1>
<p>python環境であればpyenvとか利用すれば、環境は分離できるのですが、
利用しているPCがMacとWindowsの両方あります(Macの方が性能が低いです)、
Macの方がプログラミングはしやすいのですが、
深層学習には軽い実験をするのにもマシンパワーが必要となるため、
実行だけはWindowsでやりたいわけです。
MacとWindowsで同じように動く環境を構築するのがめんどくさいという理由です。</p>
<h1 id="heading3">注意</h1>
<h2 id="dokcer">Dokcerと深層学習のフレームワーク</h2>
<h3 id="tensorflowdocker">Tensorflowを利用するならばDockerに公式があります</h3>
<p>TensorflowのDockerイメージは、Docker Hubにあります。</p>
<p><a href="https://hub.docker.com/r/tensorflow/tensorflow/">PUBLIC REPOSITORY:tensorflow/tensorflow</a></p>
<p>上記イメージは、python2.7になります。
python3系のdockerイメージは公開されていないそうです。
python3系でTensorFlowを利用したい場合は、
公式からForkしてPython3対応を公開されている方がいらっしゃいましたので、
以下を利用すれば良いと思います。</p>
<ul>
<li><a href="https://github.com/tkhm/tensorflow/tree/feature-py3">khm/tensorflow: branch/feature-py3</a></li>
<li><a href="http://qiita.com/tkhm/items/6c2b021d552e009b04a9">TensorFlow の Docker Image を Python3 で動かす</a></li>
</ul>
<h3 id="heading4">その他</h3>
<ul>
<li>Docker Habに公式イメージがあるフレームワーク
<ul>
<li><a href="https://hub.docker.com/r/chainer/chainer/">PUBLIC | AUTOMATED BUILD chainer/chainer</a></li>
</ul>
</li>
<li>公式が見つからなかったフレームワーク
<ul>
<li>Caffe</li>
<li>DeepDream</li>
</ul>
</li>
</ul>
<h2 id="macwindowsgpu">MacとWindowsではGPUの利用はできません</h2>
<p>深層学習で遊ぶためにはGPGPUを利用した方が高速に処理できます。
(場合によってはCPUでは現実時間で終わりません。)
ただし、MacかWindowsでDockerを利用する場合、GPUデバイスにアクセスできないため、
CPU実行しかできません。
必要に応じてLinux環境が純粋に入っているPCを用意する必要がありそうです。</p>
<h1 id="heading5">作業</h1>
<ol>
<li>Docker Hubから公式のpythonイメージを選びます</li>
<li>pip installでnumpyとmatplotlibをインストールします</li>
</ol>
<p>(注意1)
matplotlibはグラフ描画しようとした時に、
ディスプレイ設定がおかしいと行ってエラーが発生します。
基本的には、import時に下記のようにすることで対処できるそうです。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">import</span> matplotlib
matplotlib<span style="color:#f92672">.</span>use(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Agg</span><span style="color:#e6db74">&#39;</span>)
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
</code></pre></div><p>(注意2)
Dockerで起動しているので、xdisplayとかめんどくさいので、
画像出力して確認すればいいと思うので、下記のように実行します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">import</span> matplotlib
matplotlib<span style="color:#f92672">.</span>use(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">SVG</span><span style="color:#e6db74">&#39;</span>)
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt

fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure()
ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>gca()
ax<span style="color:#f92672">.</span>plot([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>])
fig<span style="color:#f92672">.</span>savefig(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">hoge.svg</span><span style="color:#e6db74">&#39;</span>)
</code></pre></div><h2 id="windowscuser">WindowsでC:/User配下以外をマウントする方法</h2>
<p>WindowsでC:/Users配下以外をマウントする場合は、
VirtulBox(Docker Toolboxを利用しています)でコンテナを起動するホストマシンの
共有フォルダを追加します。
例えば、C:/workフォルダを共有したい場合は、C:/workとc/workのように記載します。
(これはデフォルトで設定されているc:/usersに合わせて記載しています)</p>
<p>次に下記のようにコマンドを実施し、ホストマシンにマウントします。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$ docker-machine ssh dev <span style="color:#e6db74">&#39;sudo mount -t vboxsf -o uid=0,gid=0 c/work /c/work&#39;</span>
</code></pre></div><h1 id="heading6">失敗</h1>
<h2 id="alpinenumpy">Alpineでやろうとしたらnumpyインストールができず</h2>
<p>python3.5.2-alpineをベースとして、
numpyとmatplotlibをインストールしようとしたのですが、
numpyのインストールができず諦めました。
alpineをベースとして実現している方はいらっしゃるので、
きちんとやればできるのでしょうか、今回は時間かかりそうなのでやめました。
blasとlapackはインストールできたのですが、
numpyのインストールでエラーが発生していました。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Command <span style="color:#e6db74">&#34;/usr/local/bin/python3.5 -u -c &#34;</span>import setuptools, tokenize;__file__<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/tmp/pip-build-tv7btsqy/numpy/setup.py&#39;</span>;f<span style="color:#f92672">=</span>getattr<span style="color:#f92672">(</span>tokenize, <span style="color:#e6db74">&#39;open&#39;</span>, open<span style="color:#f92672">)</span><span style="color:#f92672">(</span>__file__<span style="color:#f92672">)</span>;code<span style="color:#f92672">=</span>f.read<span style="color:#f92672">(</span><span style="color:#f92672">)</span>.replace<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;\r\n&#39;</span>, <span style="color:#e6db74">&#39;\n&#39;</span><span style="color:#f92672">)</span>;f.close<span style="color:#f92672">(</span><span style="color:#f92672">)</span>;exec<span style="color:#f92672">(</span>compile<span style="color:#f92672">(</span>code, __file__, <span style="color:#e6db74">&#39;exec&#39;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#e6db74">&#34; install --record /tmp/pip-4d9kyt_m-record/install-record.txt --single-version-externally-managed --compile&#34;</span> failed with error code <span style="color:#ae81ff">1</span> in /tmp/pip-build-tv7btsqy/numpy/
</code></pre></div>
    <div class = 'post_extra'><div class = 'copy' data-share = 'Share Story' data-copied = 'Link Copied'>
  <svg>
    <use xlink:href="#copy"></use>
  </svg>  
</div>

    </div>

  </article>
  



  <aside>
<h3>Referenced from</h3>
<ul class='posts aside'>
</ul>

<h3>More from しさく</h3>
<ul class='posts aside'>
  
<li class = 'post_item'>
  <a class = 'post_card' href='/scrapbook/softwaretool/git/merge_git_repositories/' title = '複数の git リポジトリの履歴を残して単一のリポジトリに統合する' style = 'background-image: url(http://iimuz.github.io/scrapbook/images/thumbnail.svg);'>
  </a>
  <div class = 'excerpt'>
    <div class = 'excerpt_meta'><div class = 'copy' data-share = 'Share Story' data-copied = 'Link Copied'>
  <svg>
    <use xlink:href="#copy"></use>
  </svg>  
</div>

    </div>
    <h3 class = 'post_link'>
      <a href='/scrapbook/softwaretool/git/merge_git_repositories/'>複数の git リポジトリの履歴を残して単一のリポジトリに統合する</a>
    </h3>
  </div>
</li>

<li class = 'post_item'>
  <a class = 'post_card' href='/scrapbook/softwaretool/vscode/vscode-locale-error/' title = 'VSCode の Remote development で locale 警告が発生したときの対処' style = 'background-image: url(http://iimuz.github.io/scrapbook/images/thumbnail.svg);'>
  </a>
  <div class = 'excerpt'>
    <div class = 'excerpt_meta'>
      <a href = 'http://iimuz.github.io/scrapbook/tags/vscode' class = 'post_tag'>vscode
      </a><div class = 'copy' data-share = 'Share Story' data-copied = 'Link Copied'>
  <svg>
    <use xlink:href="#copy"></use>
  </svg>  
</div>

    </div>
    <h3 class = 'post_link'>
      <a href='/scrapbook/softwaretool/vscode/vscode-locale-error/'>VSCode の Remote development で locale 警告が発生したときの対処</a>
    </h3>
  </div>
</li>

</ul>


  </aside>
</div>
<script src = 'http://iimuz.github.io/scrapbook/js/autosize.min.js'></script>
<script src = 'http://iimuz.github.io/scrapbook/js/timeago.js'></script>
    </main><svg width="0" height="0" class="hidden">
  <symbol viewBox="0 0 699.428 699.428" xmlns="http://www.w3.org/2000/svg" id="copy">
    <path d="M502.714 0H240.428C194.178 0 153 42.425 153 87.429l-25.267.59c-46.228 0-84.019 41.834-84.019 86.838V612c0 45.004 41.179 87.428 87.429 87.428H459c46.249 0 87.428-42.424 87.428-87.428h21.857c46.25 0 87.429-42.424 87.429-87.428v-349.19zM459 655.715H131.143c-22.95 0-43.714-21.441-43.714-43.715V174.857c0-22.272 18.688-42.993 41.638-42.993l23.933-.721v393.429C153 569.576 194.178 612 240.428 612h262.286c0 22.273-20.765 43.715-43.714 43.715zm153-131.143c0 22.271-20.765 43.713-43.715 43.713H240.428c-22.95 0-43.714-21.441-43.714-43.713V87.429c0-22.272 20.764-43.714 43.714-43.714H459c-.351 50.337 0 87.975 0 87.975 0 45.419 40.872 86.882 87.428 86.882H612zm-65.572-349.715c-23.277 0-43.714-42.293-43.714-64.981V44.348L612 174.857zm-43.714 131.537H306c-12.065 0-21.857 9.77-21.857 21.835s9.792 21.835 21.857 21.835h196.714c12.065 0 21.857-9.771 21.857-21.835 0-12.065-9.792-21.835-21.857-21.835zm0 109.176H306c-12.065 0-21.857 9.77-21.857 21.834 0 12.066 9.792 21.836 21.857 21.836h196.714c12.065 0 21.857-9.77 21.857-21.836 0-12.064-9.792-21.834-21.857-21.834z"
    ></path>
  </symbol>
  <symbol viewBox="0 0 60.015 60.015" xmlns="http://www.w3.org/2000/svg" id="reply">
    <path d="M42.007 0h-24c-9.925 0-18 8.075-18 18v14c0 9.59 7.538 17.452 17 17.973v8.344a1.694 1.694 0 0 0 1.699 1.698c.44 0 .873-.173 1.198-.498l1.876-1.876C26.708 52.713 33.259 50 40.227 50h1.78c9.925 0 18-8.075 18-18V18c0-9.925-8.075-18-18-18zm16 32c0 8.822-7.178 16-16 16h-1.78c-7.502 0-14.556 2.921-19.86 8.226l-1.359 1.359V44a1 1 0 1 0-2 0v3.949c-8.356-.52-15-7.465-15-15.949V18c0-8.822 7.178-16 16-16h24c8.822 0 16 7.178 16 16v14z"></path>
  </symbol>
</svg>
<footer class = 'footer'>
  <div class = 'footer_inner wrap pale'>
    <p>&copy; <span class = 'year'></span> しさく</p>
    <p>Designed by  <a href = '<no value>' title = 'Linkedin Profile'><no value></a></p>
  </div>
</footer>

<script src = 'http://iimuz.github.io/scrapbook/js/index.js'></script>

  </body>
</html>
